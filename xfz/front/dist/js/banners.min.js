function Banners(){}Banners.prototype.createBannnerItem=function(n){var e=this,t=template("banner-item",{banner:n}),a=$(".banner-list-group"),i=null;i=n?(a.append(t),a.find(".banner-item:last")):(a.prepend(t),a.find(".banner-item:first")),e.listenRemoveBannerEvent(i),e.listenSaveBannerEvent(i),e.listenQiniuUploadFileEvent(i)},Banners.prototype.listenAddBannerEvent=function(){var n=this,e=$(".banner-list-group");$("#add-banner-btn").click(function(){6<=e.children().length?window.messageBox.showInfo("最多只能添加六张轮播图"):n.createBannnerItem()})},Banners.prototype.addImageSelectEvent=function(n){var t=n.find(".thumbnail"),e=n.find(".image-input");t.click(function(){e.click()}),e.change(function(){var n=this.files[0],e=new FormData;e.append("file",n),xfzajax.post({url:"/cms/upload_file/",data:e,processData:!1,contentType:!1,success:function(n){if(200===n.code){var e=n.data.url;t.attr("src",e)}}})})},Banners.prototype.listenQiniuUploadFileEvent=function(n){var r=this,s=n.find(".thumbnail"),e=n.find(".image-input");s.click(function(){e.click()}),e.change(function(){var o=this.files[0];xfzajax.get({url:"/cms/qntoken/",success:function(n){if(200===n.code){var e=n.data.token,t=(new Date).getTime()+"."+o.name.split(".")[1],a={fname:t,params:{},mimeType:["image/png","image/gif","image/jpeg"]},i={useCdnDomain:!0,retryCount:6,region:qiniu.region.z2};qiniu.upload(o,t,e,a,i).subscribe({next:r.handleFileUploadProgress,error:r.handleFileUploadError,complete:function(n){console.log(n);var e="http://q071w4n4d.bkt.clouddn.com/"+n.key;console.log(e),s.attr("src",e)}})}}})})},Banners.prototype.handleFileUploadProgress=function(n){},Banners.prototype.handleFileUploadError=function(n){window.messageBox.showError(n.message)},Banners.prototype.handleFileUploadComplete=function(n){console.log(n);var e="http://q071w4n4d.bkt.clouddn.com/"+n.key;console.log(e),this.url=e},Banners.prototype.listenRemoveBannerEvent=function(e){e.find("#close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({text:"您确定要删除这个轮播图吗？",confirmCallback:function(){xfzajax.post({url:"/cms/delete_banner/",data:{banner_id:n},success:function(n){200===n.code&&(e.remove(),window.messageBox.showSuccess("删除成功"))}})}}):e.remove()})},Banners.prototype.listenSaveBannerEvent=function(a){var n=a.find("#save-btn"),i=a.find(".thumbnail"),o=a.find("input[name='priority']"),r=a.find("input[name='link_to']"),s=a.find('span[class="priority"]'),c=a.attr("data-banner-id"),l="";l=c?"/cms/edit_banner/":"/cms/add_banner/",n.click(function(){var n=i.attr("src"),e=o.val(),t=r.val();xfzajax.post({url:l,data:{image_url:n,priority:e,link_to:t,pk:c},success:function(n){200===n.code&&(c?window.messageBox.showSuccess("轮播图修改成功"):(c=n.data.banner_id,a.attr("data-banner-id",c),window.messageBox.showSuccess("轮播图添加成功")),s.text("优先级："+e),window.location.reload())}})})},Banners.prototype.loadData=function(){var i=this;xfzajax.get({url:"/cms/banner_list/",success:function(n){if(200===n.code)for(var e=n.data,t=0;t<e.length;t++){var a=e[t];i.createBannnerItem(a)}}})},Banners.prototype.run=function(){this.listenAddBannerEvent(),this.loadData()},$(function(){(new Banners).run()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhbm5lcnMuanMiXSwibmFtZXMiOlsiQmFubmVycyIsInByb3RvdHlwZSIsImNyZWF0ZUJhbm5uZXJJdGVtIiwiYmFubmVyIiwic2VsZiIsInRoaXMiLCJ0cGwiLCJ0ZW1wbGF0ZSIsImJhbm5lckxpc3RHcm91cCIsIiQiLCJiYW5uZXJJdGVtIiwiYXBwZW5kIiwiZmluZCIsInByZXBlbmQiLCJsaXN0ZW5SZW1vdmVCYW5uZXJFdmVudCIsImxpc3RlblNhdmVCYW5uZXJFdmVudCIsImxpc3RlblFpbml1VXBsb2FkRmlsZUV2ZW50IiwibGlzdGVuQWRkQmFubmVyRXZlbnQiLCJjbGljayIsImNoaWxkcmVuIiwibGVuZ3RoIiwid2luZG93IiwibWVzc2FnZUJveCIsInNob3dJbmZvIiwiYWRkSW1hZ2VTZWxlY3RFdmVudCIsImltYWdlIiwiaW1hZ2VJbnB1dCIsImNoYW5nZSIsImZpbGUiLCJmaWxlcyIsImZvcm1EYXRhIiwiRm9ybURhdGEiLCJ4ZnphamF4IiwicG9zdCIsInVybCIsImRhdGEiLCJwcm9jZXNzRGF0YSIsImNvbnRlbnRUeXBlIiwic3VjY2VzcyIsInJlc3VsdCIsImF0dHIiLCJnZXQiLCJ0b2tlbiIsImtleSIsIkRhdGUiLCJnZXRUaW1lIiwibmFtZSIsInNwbGl0IiwicHV0RXh0cmEiLCJmbmFtZSIsInBhcmFtcyIsIm1pbWVUeXBlIiwiY29uZmlnIiwidXNlQ2RuRG9tYWluIiwicmV0cnlDb3VudCIsInJlZ2lvbiIsInFpbml1IiwiejIiLCJ1cGxvYWQiLCJzdWJzY3JpYmUiLCJuZXh0IiwiaGFuZGxlRmlsZVVwbG9hZFByb2dyZXNzIiwiZXJyb3IiLCJoYW5kbGVGaWxlVXBsb2FkRXJyb3IiLCJjb21wbGV0ZSIsInJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsInNob3dFcnJvciIsIm1lc3NhZ2UiLCJoYW5kbGVGaWxlVXBsb2FkQ29tcGxldGUiLCJiYW5uZXJJZCIsInhmemFsZXJ0IiwiYWxlcnRDb25maXJtIiwidGV4dCIsImNvbmZpcm1DYWxsYmFjayIsImJhbm5lcl9pZCIsInJlbW92ZSIsInNob3dTdWNjZXNzIiwic2F2ZUJ0biIsImltYWdlVGFnIiwicHJpb3JpdHlUYWciLCJsaW5rVG9UYWciLCJwcmlvcml0eVNwYW4iLCJpbWFnZV91cmwiLCJwcmlvcml0eSIsInZhbCIsImxpbmtfdG8iLCJwayIsImxvY2F0aW9uIiwicmVsb2FkIiwibG9hZERhdGEiLCJiYW5uZXJzIiwiaSIsInJ1biJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsV0FJVEEsUUFBUUMsVUFBVUMsa0JBQW9CLFNBQVVDLEdBQzVDLElBQUlDLEVBQU9DLEtBQ1BDLEVBQU1DLFNBQVMsY0FBZSxDQUFDSixPQUFVQSxJQUN6Q0ssRUFBa0JDLEVBQUUsc0JBQ3BCQyxFQUFhLEtBR2JBLEVBRkFQLEdBQ0FLLEVBQWdCRyxPQUFPTCxHQUNWRSxFQUFnQkksS0FBSyx1QkFFbENKLEVBQWdCSyxRQUFRUCxHQUNYRSxFQUFnQkksS0FBSyx1QkFHdENSLEVBQUtVLHdCQUF3QkosR0FDN0JOLEVBQUtXLHNCQUFzQkwsR0FDM0JOLEVBQUtZLDJCQUEyQk4sSUFHcENWLFFBQVFDLFVBQVVnQixxQkFBdUIsV0FDckMsSUFBSWIsRUFBT0MsS0FDUEcsRUFBa0JDLEVBQUUsc0JBQ1hBLEVBQUUsbUJBQ1JTLE1BQU0sV0FFSyxHQUREVixFQUFnQlcsV0FBV0MsT0FFcENDLE9BQU9DLFdBQVdDLFNBQVMsZUFhL0JuQixFQUFLRix1QkFJYkYsUUFBUUMsVUFBVXVCLG9CQUFzQixTQUFVZCxHQUM5QyxJQUFJZSxFQUFRZixFQUFXRSxLQUFLLGNBRXhCYyxFQUFhaEIsRUFBV0UsS0FBSyxnQkFDakNhLEVBQU1QLE1BQU0sV0FFUlEsRUFBV1IsVUFHZlEsRUFBV0MsT0FBTyxXQUNkLElBQUlDLEVBQU92QixLQUFLd0IsTUFBTSxHQUNsQkMsRUFBVyxJQUFJQyxTQUVuQkQsRUFBU25CLE9BQU8sT0FBUWlCLEdBQ3hCSSxRQUFRQyxLQUFLLENBQ1RDLElBQU8sb0JBQ1BDLEtBQVFMLEVBQ1JN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YSxLQUFhLFVBQ3JDN0IsRUFBVzhCLEtBQUssaUJBQWtCK0IsR0FDbENsRCxPQUFPQyxXQUFXd0QsWUFBWSxZQUVsQ0ssRUFBYVQsS0FBSyxPQUFTVyxHQUMzQmhFLE9BQU9vRSxTQUFTQyxnQkFRcEMxRixRQUFRQyxVQUFVMEYsU0FBVyxXQUN6QixJQUFJdkYsRUFBT0MsS0FDWDJCLFFBQVFTLElBQUksQ0FDUlAsSUFBTyxvQkFDUEksUUFBVyxTQUFVQyxHQUNqQixHQUF1QixNQUFuQkEsRUFBYSxLQUViLElBREEsSUFBSXFELEVBQVVyRCxFQUFhLEtBQ2xCc0QsRUFBSSxFQUFHQSxFQUFJRCxFQUFReEUsT0FBUXlFLElBQUssQ0FDckMsSUFBSTFGLEVBQVN5RixFQUFRQyxHQUNyQnpGLEVBQUtGLGtCQUFrQkMsUUFPM0NILFFBQVFDLFVBQVU2RixJQUFNLFdBQ1R6RixLQUNOWSx1QkFETVosS0FFTnNGLFlBR1RsRixFQUFFLFlBQ2dCLElBQUlULFNBQ1Y4RiIsImZpbGUiOiJiYW5uZXJzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIEJhbm5lcnMoKSB7XHJcblxyXG59XHJcblxyXG5CYW5uZXJzLnByb3RvdHlwZS5jcmVhdGVCYW5ubmVySXRlbSA9IGZ1bmN0aW9uIChiYW5uZXIpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciB0cGwgPSB0ZW1wbGF0ZShcImJhbm5lci1pdGVtXCIsIHtcImJhbm5lclwiOiBiYW5uZXJ9KTtcclxuICAgIHZhciBiYW5uZXJMaXN0R3JvdXAgPSAkKFwiLmJhbm5lci1saXN0LWdyb3VwXCIpO1xyXG4gICAgdmFyIGJhbm5lckl0ZW0gPSBudWxsO1xyXG4gICAgaWYgKGJhbm5lcikge1xyXG4gICAgICAgIGJhbm5lckxpc3RHcm91cC5hcHBlbmQodHBsKTtcclxuICAgICAgICBiYW5uZXJJdGVtID0gYmFubmVyTGlzdEdyb3VwLmZpbmQoXCIuYmFubmVyLWl0ZW06bGFzdFwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYmFubmVyTGlzdEdyb3VwLnByZXBlbmQodHBsKTtcclxuICAgICAgICBiYW5uZXJJdGVtID0gYmFubmVyTGlzdEdyb3VwLmZpbmQoXCIuYmFubmVyLWl0ZW06Zmlyc3RcIik7XHJcbiAgICB9XHJcbiAgICAvLyBzZWxmLmFkZEltYWdlU2VsZWN0RXZlbnQoYmFubmVySXRlbSk7XHJcbiAgICBzZWxmLmxpc3RlblJlbW92ZUJhbm5lckV2ZW50KGJhbm5lckl0ZW0pO1xyXG4gICAgc2VsZi5saXN0ZW5TYXZlQmFubmVyRXZlbnQoYmFubmVySXRlbSk7XHJcbiAgICBzZWxmLmxpc3RlblFpbml1VXBsb2FkRmlsZUV2ZW50KGJhbm5lckl0ZW0pO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUubGlzdGVuQWRkQmFubmVyRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgYmFubmVyTGlzdEdyb3VwID0gJChcIi5iYW5uZXItbGlzdC1ncm91cFwiKTtcclxuICAgIHZhciBhZGRCdG4gPSAkKFwiI2FkZC1iYW5uZXItYnRuXCIpO1xyXG4gICAgYWRkQnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgbGVuZ3RoID0gYmFubmVyTGlzdEdyb3VwLmNoaWxkcmVuKCkubGVuZ3RoO1xyXG4gICAgICAgIGlmIChsZW5ndGggPj0gNikge1xyXG4gICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93SW5mbyhcIuacgOWkmuWPquiDvea3u+WKoOWFreW8oOi9ruaSreWbvlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB2YXIgdHBsID0gdGVtcGxhdGUoXCJiYW5uZXItaXRlbVwiKTtcclxuICAgICAgICAvLyB2YXIgYmFubmVyTGlzdEdyb3VwID0gJChcIi5iYW5uZXItbGlzdC1ncm91cFwiKTtcclxuICAgICAgICAvLyBiYW5uZXJMaXN0R3JvdXAucHJlcGVuZCh0cGwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gLy/kvb/nlKhhcnR0ZW1wbGF0ZeW/hemhu+a3u+WKoOWujOaIkOWQjuaJjeiDvee7keWumueCueWHu+S6i+S7tuetieaTjeS9nFxyXG4gICAgICAgIC8vIC8v6YCa6L+H6L2u5pKt5Zu+57uE5om+5Yiw5paw5re75Yqg55qE6L2u5pKt5Zu+XHJcbiAgICAgICAgLy8gdmFyIGJhbm5lckl0ZW0gPSBiYW5uZXJMaXN0R3JvdXAuZmluZChcIi5iYW5uZXItaXRlbTpmaXJzdFwiKTtcclxuICAgICAgICAvLyBzZWxmLmFkZEltYWdlU2VsZWN0RXZlbnQoYmFubmVySXRlbSk7XHJcbiAgICAgICAgLy8gc2VsZi5saXN0ZW5SZW1vdmVCYW5uZXJFdmVudChiYW5uZXJJdGVtKTtcclxuICAgICAgICAvLyBzZWxmLmxpc3RlblNhdmVCYW5uZXJFdmVudChiYW5uZXJJdGVtKTtcclxuICAgICAgICBzZWxmLmNyZWF0ZUJhbm5uZXJJdGVtKCk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmFkZEltYWdlU2VsZWN0RXZlbnQgPSBmdW5jdGlvbiAoYmFubmVySXRlbSkge1xyXG4gICAgdmFyIGltYWdlID0gYmFubmVySXRlbS5maW5kKCcudGh1bWJuYWlsJyk7XHJcbiAgICAvL+WbvueJh+aYr+S4jeiDveaJk+W8gOaWh+S7tumAieaLqeeql+WPo+eahO+8jOWPquiDvemAmui/h2lucHV05qCH562+XHJcbiAgICB2YXIgaW1hZ2VJbnB1dCA9IGJhbm5lckl0ZW0uZmluZCgnLmltYWdlLWlucHV0Jyk7XHJcbiAgICBpbWFnZS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgLy/pgJrov4fngrnlh7vlm77niYfvvIzlrp7njrBpbnB1dOagh+etvueahOeCueWHu1xyXG4gICAgICAgIGltYWdlSW5wdXQuY2xpY2soKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGltYWdlSW5wdXQuY2hhbmdlKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZmlsZSA9IHRoaXMuZmlsZXNbMF07XHJcbiAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgLy/lkI7nq6/pgJrov4dyZXF1ZXN0LkZJTEVTLmdldCgnZmlsZScp6I635Y+W5paH5Lu2XHJcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBmaWxlKTtcclxuICAgICAgICB4ZnphamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICAndXJsJzogJy9jbXMvdXBsb2FkX2ZpbGUvJyxcclxuICAgICAgICAgICAgJ2RhdGEnOiBmb3JtRGF0YSxcclxuICAgICAgICAgICAgJ3Byb2Nlc3NEYXRhJzogZmFsc2UsXHJcbiAgICAgICAgICAgICdjb250ZW50VHlwZSc6IGZhbHNlLFxyXG4gICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IHJlc3VsdFsnZGF0YSddWyd1cmwnXTtcclxuICAgICAgICAgICAgICAgICAgICBpbWFnZS5hdHRyKCdzcmMnLCB1cmwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmxpc3RlblFpbml1VXBsb2FkRmlsZUV2ZW50ID0gZnVuY3Rpb24gKGJhbm5lckl0ZW0pIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBpbWFnZSA9IGJhbm5lckl0ZW0uZmluZCgnLnRodW1ibmFpbCcpO1xyXG4gICAgLy/lm77niYfmmK/kuI3og73miZPlvIDmlofku7bpgInmi6nnqpflj6PnmoTvvIzlj6rog73pgJrov4dpbnB1dOagh+etvlxyXG4gICAgdmFyIGltYWdlSW5wdXQgPSBiYW5uZXJJdGVtLmZpbmQoJy5pbWFnZS1pbnB1dCcpO1xyXG4gICAgaW1hZ2UuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8v6YCa6L+H54K55Ye75Zu+54mH77yM5a6e546waW5wdXTmoIfnrb7nmoTngrnlh7tcclxuICAgICAgICBpbWFnZUlucHV0LmNsaWNrKCk7XHJcbiAgICB9KTtcclxuICAgIGltYWdlSW5wdXQuY2hhbmdlKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZmlsZSA9IHRoaXMuZmlsZXNbMF07XHJcbiAgICAgICAgeGZ6YWpheC5nZXQoe1xyXG4gICAgICAgICAgICAndXJsJzogJy9jbXMvcW50b2tlbi8nLFxyXG4gICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuID0gcmVzdWx0WydkYXRhJ11bJ3Rva2VuJ107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgKyAnLicgKyBmaWxlLm5hbWUuc3BsaXQoJy4nKVsxXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHV0RXh0cmEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuYW1lOiBrZXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczoge30sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbWVUeXBlOiBbJ2ltYWdlL3BuZycsICdpbWFnZS9naWYnLCAnaW1hZ2UvanBlZyddXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VDZG5Eb21haW46IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5Q291bnQ6IDYsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogcWluaXUucmVnaW9uLnoyXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb2JzZXJ2YWJsZSA9IHFpbml1LnVwbG9hZChmaWxlLCBrZXksIHRva2VuLCBwdXRFeHRyYSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLnN1YnNjcmliZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmV4dFwiOiBzZWxmLmhhbmRsZUZpbGVVcGxvYWRQcm9ncmVzcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJlcnJvclwiOiBzZWxmLmhhbmRsZUZpbGVVcGxvYWRFcnJvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gXCJjb21wbGV0ZVwiOiBzZWxmLmhhbmRsZUZpbGVVcGxvYWRDb21wbGV0ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbXBsZXRlXCI6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvbWFpbiA9ICdodHRwOi8vcTA3MXc0bjRkLmJrdC5jbG91ZGRuLmNvbS8nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gcmVzcG9uc2Uua2V5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IGRvbWFpbiArIGZpbGVuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLmF0dHIoJ3NyYycsIHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KTtcclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmhhbmRsZUZpbGVVcGxvYWRQcm9ncmVzcyA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxufTtcclxuXHJcbkJhbm5lcnMucHJvdG90eXBlLmhhbmRsZUZpbGVVcGxvYWRFcnJvciA9IGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgd2luZG93Lm1lc3NhZ2VCb3guc2hvd0Vycm9yKGVycm9yLm1lc3NhZ2UpO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUuaGFuZGxlRmlsZVVwbG9hZENvbXBsZXRlID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAvLyBpbWFnZeiOt+WPluS4jeWIsO+8jOaaguaXtuS4jeefpemBk+aAjuS5iOino+WGs1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgdmFyIGRvbWFpbiA9ICdodHRwOi8vcTA3MXc0bjRkLmJrdC5jbG91ZGRuLmNvbS8nO1xyXG4gICAgdmFyIGZpbGVuYW1lID0gcmVzcG9uc2Uua2V5O1xyXG4gICAgdmFyIHVybCA9IGRvbWFpbiArIGZpbGVuYW1lO1xyXG4gICAgY29uc29sZS5sb2codXJsKTtcclxuICAgIHNlbGYudXJsID0gdXJsO1xyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUubGlzdGVuUmVtb3ZlQmFubmVyRXZlbnQgPSBmdW5jdGlvbiAoYmFubmVySXRlbSkge1xyXG4gICAgdmFyIGNsb3NlQnRuID0gYmFubmVySXRlbS5maW5kKCcjY2xvc2UtYnRuJyk7XHJcbiAgICBjbG9zZUJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGJhbm5lcklkID0gYmFubmVySXRlbS5hdHRyKCdkYXRhLWJhbm5lci1pZCcpO1xyXG4gICAgICAgIGlmIChiYW5uZXJJZCkge1xyXG4gICAgICAgICAgICB4ZnphbGVydC5hbGVydENvbmZpcm0oe1xyXG4gICAgICAgICAgICAgICAgJ3RleHQnOiAn5oKo56Gu5a6a6KaB5Yig6Zmk6L+Z5Liq6L2u5pKt5Zu+5ZCX77yfJyxcclxuICAgICAgICAgICAgICAgICdjb25maXJtQ2FsbGJhY2snOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeGZ6YWpheC5wb3N0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6ICcvY21zL2RlbGV0ZV9iYW5uZXIvJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFubmVyX2lkJzogYmFubmVySWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Wydjb2RlJ10gPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbm5lckl0ZW0ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1lc3NhZ2VCb3guc2hvd1N1Y2Nlc3MoXCLliKDpmaTmiJDlip9cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGJhbm5lckl0ZW0ucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5CYW5uZXJzLnByb3RvdHlwZS5saXN0ZW5TYXZlQmFubmVyRXZlbnQgPSBmdW5jdGlvbiAoYmFubmVySXRlbSkge1xyXG4gICAgdmFyIHNhdmVCdG4gPSBiYW5uZXJJdGVtLmZpbmQoXCIjc2F2ZS1idG5cIik7XHJcbiAgICB2YXIgaW1hZ2VUYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCIudGh1bWJuYWlsXCIpO1xyXG4gICAgdmFyIHByaW9yaXR5VGFnID0gYmFubmVySXRlbS5maW5kKFwiaW5wdXRbbmFtZT0ncHJpb3JpdHknXVwiKTtcclxuICAgIHZhciBsaW5rVG9UYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCJpbnB1dFtuYW1lPSdsaW5rX3RvJ11cIik7XHJcbiAgICB2YXIgcHJpb3JpdHlTcGFuID0gYmFubmVySXRlbS5maW5kKCdzcGFuW2NsYXNzPVwicHJpb3JpdHlcIl0nKTtcclxuICAgIHZhciBiYW5uZXJJZCA9IGJhbm5lckl0ZW0uYXR0cihcImRhdGEtYmFubmVyLWlkXCIpO1xyXG4gICAgdmFyIHVybCA9IFwiXCI7XHJcbiAgICAvLyDliKTmlq3lvZPliY3nmoTkv53lrZjmjInpkq7mmK/mm7TmlrDov5jmmK/mlrDlop7ova7mkq3lm77vvIznhLblkI7osIPnlKjnm7jlupTnmoR1cmxcclxuICAgIGlmIChiYW5uZXJJZCkge1xyXG4gICAgICAgIHVybCA9ICcvY21zL2VkaXRfYmFubmVyLyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHVybCA9IFwiL2Ntcy9hZGRfYmFubmVyL1wiO1xyXG4gICAgfVxyXG4gICAgc2F2ZUJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGltYWdlX3VybCA9IGltYWdlVGFnLmF0dHIoJ3NyYycpO1xyXG4gICAgICAgIHZhciBwcmlvcml0eSA9IHByaW9yaXR5VGFnLnZhbCgpO1xyXG4gICAgICAgIHZhciBsaW5rX3RvID0gbGlua1RvVGFnLnZhbCgpO1xyXG4gICAgICAgIHhmemFqYXgucG9zdCh7XHJcbiAgICAgICAgICAgICd1cmwnOiB1cmwsXHJcbiAgICAgICAgICAgICdkYXRhJzoge1xyXG4gICAgICAgICAgICAgICAgJ2ltYWdlX3VybCc6IGltYWdlX3VybCxcclxuICAgICAgICAgICAgICAgICdwcmlvcml0eSc6IHByaW9yaXR5LFxyXG4gICAgICAgICAgICAgICAgJ2xpbmtfdG8nOiBsaW5rX3RvLFxyXG4gICAgICAgICAgICAgICAgLy8g6Jm954S2QWRk55qERm9ybeS4reayoeacieWvuXBr6L+b6KGM5aSE55CG77yM5L2G5piv5Zyodmlld+S4reayoeacieaPkOWJjei/meS4quaVsOaNruaJgOS7peayoeacieWFs+ezu1xyXG4gICAgICAgICAgICAgICAgJ3BrJzogYmFubmVySWRcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Wydjb2RlJ10gPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiYW5uZXJJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93U3VjY2VzcyhcIui9ruaSreWbvuS/ruaUueaIkOWKn1wiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJZCA9IHJlc3VsdFsnZGF0YSddWydiYW5uZXJfaWQnXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFubmVySXRlbS5hdHRyKCdkYXRhLWJhbm5lci1pZCcsIGJhbm5lcklkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1lc3NhZ2VCb3guc2hvd1N1Y2Nlc3MoXCLova7mkq3lm77mt7vliqDmiJDlip9cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5U3Bhbi50ZXh0KFwi5LyY5YWI57qn77yaXCIgKyBwcmlvcml0eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5CYW5uZXJzLnByb3RvdHlwZS5sb2FkRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHhmemFqYXguZ2V0KHtcclxuICAgICAgICAndXJsJzogJy9jbXMvYmFubmVyX2xpc3QvJyxcclxuICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBiYW5uZXJzID0gcmVzdWx0WydkYXRhJ107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJhbm5lcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmFubmVyID0gYmFubmVyc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmNyZWF0ZUJhbm5uZXJJdGVtKGJhbm5lcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59O1xyXG5cclxuQmFubmVycy5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5saXN0ZW5BZGRCYW5uZXJFdmVudCgpO1xyXG4gICAgc2VsZi5sb2FkRGF0YSgpO1xyXG59O1xyXG5cclxuJChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgYmFubmVycyA9IG5ldyBCYW5uZXJzKCk7XHJcbiAgICBiYW5uZXJzLnJ1bigpO1xyXG59KTsiXX0=
